@import logic.DateUtils
@import model._
@import logic.CredentialsReportDisplay
@(report: CredentialReportDisplay)

<div class="row">
    <div class="card-panel">
        <span>Report generated at @{DateUtils.printTime(report.reportDate)} (refreshed every four hours)</span>
    </div>
</div>
<div class="row">
    <div class="col s12">
        <table class="striped responsive-table iam-report__table">
            <tr>
                <th>Type</th>
                <th>User name</th>
                <th>Access Keys</th>
                <th>Password/MFA</th>
                <th>Last Activity</th>
                <th>Status</th>
            </tr>

            @for(cred <- report.humanUsers) {
                <tr>
                    <td>
                        <i class="material-icons left tooltipped" data-tooltip="human user" data-position="bottom" data-delay="50">person</i>
                        @cred.stack match {
                            case Some(stack) => {
                            <a target="_blank" rel="noopener noreferrer" href="@CredentialsReportDisplay.linkForAwsConsole(stack)">
                                <i class="material-icons left tooltipped" data-tooltip="@stack.name stack" data-position="bottom" data-delay="50">cloud_done</i>
                            </a>
                            }
                            case _ => {
                                <i class="material-icons left tooltipped" data-tooltip="no CloudFormation stack" data-position="bottom" data-delay="50">cloud_off</i>
                            }
                        }
                    </td>
                    <td>
                        <a target="_blank" rel="noopener noreferrer" href="https://console.aws.amazon.com/iam/home#/users/@{cred.username}">
                            @if(cred.username.length > 30) {
                            <span class="tooltipped" data-tooltip="@cred.username">@cred.username.slice(0, 30)&hellip;</span>
                            } else {
                            <span>@cred.username</span>
                            }
                            <i class="material-icons link_new_tab">open_in_new</i>
                        </a>
                    </td>
                    <td>@views.html.fragments.allKeyStatus(cred.key1Status, cred.key2Status)

                    </td>
                    <td>
                        <i class="material-icons left tooltipped" data-tooltip="Password enabled">lock_outline</i>
                        @if(cred.hasMFA) {
                        <i class="material-icons left tooltipped" data-position="bottom" data-delay="50" data-tooltip="MFA enabled">important_devices</i>
                        }
                    </td>
                    <td>
                        <span>@CredentialsReportDisplay.toDayString(cred.lastActivityDay)</span>
                    </td>
                    <td>@views.html.fragments.humanReportStatus(cred.reportStatus)</td>
                </tr>
            }

            @for(cred <- report.machineUsers) {
                <tr>
                    <td>
                        <i class="material-icons left tooltipped" data-tooltip="machine user" data-position="bottom" data-delay="50">computer</i>
                        @cred.stack match {
                            case Some(stack) => {
                                <a target="_blank" rel="noopener noreferrer" href="@CredentialsReportDisplay.linkForAwsConsole(stack)">
                                    <i class="material-icons left tooltipped" data-tooltip="@stack.name stack" data-position="bottom" data-delay="50">cloud_done</i>
                                </a>
                            }
                            case _ => {
                                <i class="material-icons left tooltipped" data-tooltip="no CloudFormation stack" data-position="bottom" data-delay="50">cloud_off</i>
                            }
                        }
                    </td>
                    <td>
                        <a target="_blank" rel="noopener noreferrer" href="https://console.aws.amazon.com/iam/home#/users/@{cred.username}">
                            @if(cred.username.length > 30) {
                                <span class="tooltipped" data-tooltip="@cred.username">@cred.username.slice(0, 30)&hellip;</span>
                            } else {
                                <span>@cred.username</span>
                            }
                            <i class="material-icons link_new_tab">open_in_new</i>
                        </a>
                    </td>
                    <td>@views.html.fragments.allKeyStatus(cred.key1Status, cred.key2Status)</td>
                    <td><span>-</span></td>
                    <td>
                        <span>@CredentialsReportDisplay.toDayString(cred.lastActivityDay)</span>
                    </td>
                    <td>@views.html.fragments.machineReportStatus(cred.reportStatus)</td>
                </tr>
            }
        </table>
    </div>
</div>
