# Vulnerability Management

Writing secure software is hard. Unfortunately for Developers the days when this bit cold be handed off to another team
are long gone. [DevSecOps](https://www.csoonline.com/article/3245748/what-is-devsecops-developing-more-secure-applications.html)
is a fairly established thing these days which is the idea that application and infrastructure security should be thought
about 'from the start' - so at the point you're writing code and creating infrastructure.

The other big thing in DevSecOps is that security should be  automated so it doesn't slow development teams down. A great
example of automated security at The Guardian is [Janus](https://github.com/guardian/janus). Unfortunately  there are some
tasks that can't easily be automated, or we haven't got round to automating yet. These areas are discussed below.


## Vulnerabilities via 3rd party libraries
<img src="https://imgs.xkcd.com/comics/dependency_2x.png" width="300">

This type of vulnerability will likely be the most time consuming to keep on top of. Pretty much every major open source
library will at some point need updating to fix a security concern. Most of the time this should be as simple as changing
a version number in your build.sbt or package.json file, but it could involve days of work upgrading, for example, your
version of the Play! Framework. The (draft) standard for Patch Management at The Guardian states:

 ```
All GNM managed third party applications must be patched on a regular basis as patches are released.

Technical owners are responsible to establish such a process.
```  
### 1. Find the vulnerabilities
At The Guardian we recommend 2 tools for vulnerabilities: Snyk and Dependabot

#### Snyk
The Guardian has an enterprise account with Snyk, which will scan your repo for vulnerabilities and open PRs where possible
to resolve them. This is the recommended tool for Scala projects. We have unlimited scans with Snyk so you shouldn't
hesitate to enable it in your project. Full documentation exists [here](./snyk.md). For a summary of all Snyk vulnerabilities
at The Guardian in one place you can head to the [Snyk dashboard on Security HQ](https://security-hq.gutools.co.uk/snyk) 
(VPN required).

#### Dependabot
Dependabot is a similar tool by Github. For TypeScript/Javascript projects you might choose to use this instead of Snyk
as it integrates well with the Github UI. (It's not worth switching if you're already set up with Snyk though). It opens
 automated PRs, but you can also see more detail, including any PRs that have been ignored/closed in the 'Security' tab
 of your repo. One downside of Dependabot is that there's no API or central dashboard, so the only way of checking dependency
 issues is by going to each repo one by one.
 
One thing to note is that dependabot will tell you when there's a new version of a library even if there isn't a security
concern. If you're trying to save time you might opt to skip these - any security related fixes will say so in the PR
description.  
 
### 2. Prioritise the vulnerabilities
Soo, your team should have some kind of process for staying up to date with patching. Not every vulnerability highlighted by
Snyk or Dependabot necessarily needs fixing - maybe the way your app works (e.g. in a private VPC) means that the vulnerability
listed isn't of concern. However, in many cases it's easier to fix rather than to justify not fixing something though, and in general
it's good to have 'defence in depth' - so to assume that any other security measures might get compromised and not to rely on
e.g. network security. 

Initially you might choose to target only 'high' criticality vulnerabilities. 

### 3. Fix them!

This can be the sloow, hard part! In future, there might be links to docs on dealing with e.g. awkward play upgrades,
dodgy AWS SDK dependencies, but for now all we can say is 

![good luck](https://media2.giphy.com/media/3oeSAz6FqXCKuNFX6o/giphy.gif)


## Infrastructure vulnerabilities

### Security HQ
Coming soon: what are the key dashboards in Security HQ to focus on (or is it all of them?)

### AWS Guard Duty
Todo: Write some guidance on guard duty

### AWS Security Hub
Todo: Write some guidance on security hub

### Google Cloud Platform Security Command Centre
Todo: Add  GCP SCC data to Security HQ and write some guidance 

### Operating system patches
You should be regularly replacing your AMIs to get the latest security patches. Head to [AMIable](amiable.gutools.co.uk/)
to check out the current situation in your account.